<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mood Chat</title>
    <style>
        :root{
            --bg:#0f172a; --panel:#111827; --panel-2:#1f2937; --text:#e5e7eb; --muted:#9ca3af;
            --accent:#22c55e; --accent-2:#3b82f6; --shadow: 0 10px 30px rgba(0,0,0,.35); --radius: 16px;
        }
        *{box-sizing:border-box} html,body{height:100%}
        body{
            margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica, Arial;
            background: radial-gradient(1200px 800px at 80% -10%, #0ea5e9 0%, transparent 60%),
            radial-gradient(900px 700px at -10% 110%, #22c55e 0%, transparent 50%),
            var(--bg);
            color:var(--text); display:grid; place-items:center; padding:24px;
        }
        .app{ width:min(950px,100%); }
        header{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px 18px;
            background: rgba(17,24,39,.6); border:1px solid rgba(255,255,255,.06); border-radius: var(--radius); box-shadow: var(--shadow); margin-bottom:16px; }
        header .brand{ display:flex; align-items:center; gap:10px; font-weight:700; }
        header .logo{ width:36px; height:36px; display:grid; place-items:center; background:linear-gradient(135deg, var(--accent), var(--accent-2)); border-radius:10px; color:white; font-weight:900; }

        .grid{ display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:14px; }
        @media (min-width: 720px){ .grid{ grid-template-columns: repeat(4, minmax(0,1fr)); } }
        .mood{ border:1px solid rgba(255,255,255,.06); background:linear-gradient(180deg, rgba(31,41,55,.9), rgba(17,24,39,.85));
            border-radius: var(--radius); padding:18px; cursor:pointer; transition: transform .15s ease, border-color .15s ease, box-shadow .15s ease; text-align:left; }
        .mood:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.15); box-shadow: 0 10px 24px rgba(0,0,0,.45); }
        .mood .emoji{ font-size:28px; } .mood .title{ font-weight:700; margin-top:6px; } .mood .hint{ color:var(--muted); font-size:14px; margin-top:4px; }

        .chat{ display:flex; flex-direction:column; height:70vh; background: rgba(17,24,39,.7); border:1px solid rgba(255,255,255,.06); border-radius: var(--radius); overflow:hidden; }
        .chat-header{ display:flex; align-items:center; gap:10px; padding:12px 14px; background: rgba(31,41,55,.8); border-bottom:1px solid rgba(255,255,255,.06); }
        .back{ appearance:none; border:none; background:transparent; color:var(--text); padding:8px 10px; border-radius:10px; cursor:pointer; }
        .messages{ flex:1; overflow:auto; padding:16px; display:flex; flex-direction:column; gap:10px; }
        .msg{ max-width: 80%; padding:12px 14px; border-radius: 14px; line-height:1.35; box-shadow: 0 6px 14px rgba(0,0,0,.25); }
        .bot{ align-self:flex-start; background: linear-gradient(180deg, rgba(31,41,55,.95), rgba(17,24,39,.95)); border:1px solid rgba(255,255,255,.06); }
        .user{ align-self:flex-end; background: linear-gradient(180deg, rgba(34,197,94,.2), rgba(34,197,94,.08)); border:1px solid rgba(34,197,94,.35); }
        .actions{ display:flex; flex-wrap:wrap; gap:10px; padding:14px; border-top:1px solid rgba(255,255,255,.06); background: rgba(17,24,39,.65); }
        .btn{ appearance:none; border:1px solid rgba(255,255,255,.1); background: rgba(31,41,55,.85); color: var(--text); padding:10px 14px; border-radius: 12px; cursor:pointer; font-weight:600; }
        .btn:hover{ border-color: rgba(255,255,255,.25); transform: translateY(-1px); }
        .hidden{ display:none !important; }
        .typing{ width:46px; height:30px; display:inline-flex; align-items:center; justify-content:space-between; }
        .dot{ width:8px; height:8px; border-radius:999px; background: #93c5fd; opacity:.7; animation: blink 1.2s infinite ease-in-out; }
        .dot:nth-child(2){ animation-delay:.2s } .dot:nth-child(3){ animation-delay:.4s }
        @keyframes blink{ 0%, 80%, 100%{ opacity:.2; transform: translateY(0) } 40%{ opacity:1; transform: translateY(-3px) } }
        footer{ margin-top:14px; color: var(--muted); font-size: 12px; text-align:center; }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <div class="brand"><div class="logo">CY</div><div>Cheerify</div></div>
            <div style="font-size:12px;opacity:.8">Brighten Up You Mood</div>
        </header>

        <section id="moodPicker" class="grid" aria-label="Choose your mood">
            <button class="mood" data-mood="happy"><div class="emoji">😊</div><div class="title">Happy</div><div class="hint">Good vibes</div></button>
            <button class="mood" data-mood="sad"><div class="emoji">😔</div><div class="title">Sad</div><div class="hint">I’m here with you</div></button>
            <button class="mood" data-mood="angry"><div class="emoji">😠</div><div class="title">Angry</div><div class="hint">Let’s cool down</div></button>
            <button class="mood" data-mood="normal"><div class="emoji">😌</div><div class="title">Normal</div><div class="hint">Calm check-in</div></button>
        </section>

        <section id="chat" class="chat hidden" aria-live="polite">
            <div class="chat-header">
                <button id="backBtn" class="back">⟵ Moods</button>
                <div id="chatTitle" style="font-weight:700;margin-left:8px;">Mood Chat</div>
                <div id="moodBadge" style="margin-left:auto;opacity:.8;font-size:12px"></div>
            </div>
            <div id="messages" class="messages"></div>
            <div id="actions" class="actions"></div>
        </section>

        <!-- <footer>Open <code>/index.html</code> from Spring Boot: <code>http://localhost:8080/index.html</code></footer> -->
    </div>

    <script>
        const el = {
            picker: document.getElementById('moodPicker'),
            chat: document.getElementById('chat'),
            back: document.getElementById('backBtn'),
            messages: document.getElementById('messages'),
            actions: document.getElementById('actions'),
            title: document.getElementById('chatTitle'),
            badge: document.getElementById('moodBadge'),
        };

        let currentMood = null;

        document.querySelectorAll('.mood').forEach(btn => {
            btn.addEventListener('click', () => startChat(btn.dataset.mood));
        });

        el.back.addEventListener('click', () => {
            el.chat.classList.add('hidden');
            el.picker.classList.remove('hidden');
            el.messages.innerHTML = '';
            el.actions.innerHTML = '';
            currentMood = null;
        });

        function startChat(mood){
            currentMood = mood;
            el.picker.classList.add('hidden');
            el.chat.classList.remove('hidden');
            el.title.textContent = mood[0].toUpperCase() + mood.slice(1) + ' chat';
            el.badge.textContent = mood;
            addMsg('bot', introFor(mood));
            showMainChoices();
        }

        function introFor(mood){
            const map = {
                happy:  "You're feeling happy—love that energy! Want a joke or a motivational quote?",
                sad:    "I'm sorry you're feeling sad. Want a silly joke or a gentle quote?",
                angry:  "I hear you—want a light joke to cool off or a steadying quote?",
                normal: "Neutral is fine. Want a fun joke or a motivating quote?",
            };
            return map[mood] || "How are you feeling today?";
        }

        function addMsg(role, text){
            const wrap = document.createElement('div');
            wrap.className = `msg ${role}`;
            wrap.textContent = text;
            el.messages.appendChild(wrap);
            el.messages.scrollTop = el.messages.scrollHeight;
        }

        function setActions(buttons){
            el.actions.innerHTML = '';
            buttons.forEach(b => el.actions.appendChild(b));
        }

        function button(label, onClick, primary=false){
            const b = document.createElement('button');
            b.className = 'btn' + (primary ? '' : '');
            b.textContent = label;
            b.onclick = onClick;
            return b;
        }

        function showMainChoices(){
            setActions([
                button('Wanna hear a joke 😂', () => requestItem('jokes'), true),
                button('Wanna hear a motivational quote ✨', () => requestItem('quotes')),
                button('Change mood', () => el.back.click())
            ]);
        }

        function requestItem(type){
            addMsg('user', type === 'jokes' ? 'Joke, please' : 'Quote, please');

            // Call backend with RELATIVE URL so it works when served by Spring Boot
            fetch(`http://localhost:8080/api/item?mood=${encodeURIComponent(currentMood || 'general')}&type=${encodeURIComponent(type)}`)



            .then(res => {
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                return res.json();
            })
            .then(data => {
                addMsg('bot', data.result);
                setActions([
                    button(type === 'jokes' ? 'One more joke 👍' : 'One more quote 👍', () => requestItem(type), true),
                    button('No, show options', showMainChoices),
                    button('Change mood', () => el.back.click())
                ]);
            })
            .catch(err => {
                console.error('Fetch failed:', err);
                addMsg('bot', 'Error fetching response 😢');
                showMainChoices();
            });
        }
    </script>
</body>
</html>